name: Documentation

on:
  pull_request:
    paths:
      - '*.md'
      - 'docs/**'
      - 'packages/**/*.md'
      - 'latest.json'

jobs:
  docs:
    name: Build & Verify Docs
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: 'package.json'
          cache: 'yarn'

      - name: Install dependencies
        run: yarn install --immutable

      - name: Lint docs
        run: yarn run prettier:checkDocs
        env:
          NODE_OPTIONS: --max_old_space_size=8192

      - name: Build docs website
        run: |
          mkdir -p hugo/content/docs/grafana/latest
          echo -e '---\nredirectURL: /docs/grafana/latest/\ntype: redirect\nversioned: true\n---\n' > hugo/content/docs/grafana/_index.md
          cp -r docs/sources/* hugo/content/docs/grafana/latest/
          
          docker run --rm -v $(pwd):/src grafana/docs-base:latest /bin/sh -c "cd /src/hugo && make prod"
